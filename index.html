<!DOCTYPE html>
<html>

<head>
    <title>QR Code</title>
    <style>
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        #numberBox {
            width: 200px;
            height: 30px;
            text-align: center;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .button {
            width: 60px;
            height: 40px;
            background-color: #e0e0e0;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
        }

        #backspaceButton {
            background-color: #ffcccc;
        }

        #transactionButton {
            width: 120px;
            height: 40px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
        }

        #receiveButton {
            width: 120px;
            height: 40px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
        }

        #resultBox {
            margin-top: 20px;
            display: none;
        }

        #resultBox p {
            font-size: 18px;
        }
    </style>
    <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
</head>

<body>
    <!-- Initial buttons to trigger actions -->
    <div class="container">
        <button id="receiveBalanceButton" onclick="showReceiveBalance()">Receive Balance</button>
        <button id="makeTransactionButton" onclick="startTransaction()">Make Transaction</button>
    </div>

    <!-- Receive Balance Step -->
    <div id="receiveBalanceStep" style="display: none;">
        <div class="container">
            <!-- Display card number and password input boxes -->
            <div>Card Number: <input type="text" id="cardNumberInput" /></div>
            <div>Password: <input type="password" id="passwordInput" /></div>
            <button id="checkPasswordButton" onclick="checkPassword()">Check Password</button>
        </div>
    </div>

    <!-- Transaction Result -->
    <div id="resultBox" style="display: none;">
        <p id="transactionResult"></p>
    </div>

    <!-- Video preview for scanning QR code -->
    <video id="preview" style="display: none;"></video>

    <script>
        let cards = [
            { card: 12345678, code: 1234, name: 'mohamad', value: 2000 },
            { card: 23457681, code: 5661, name: 'sobhan', value: 11000 }
        ];
        let enteredCode = '';
        let scanner;

        function showReceiveBalance() {
            // Hide initial buttons
            document.getElementById('receiveBalanceButton').style.display = 'none';
            document.getElementById('makeTransactionButton').style.display = 'none';
            // Show receive balance step
            document.getElementById('receiveBalanceStep').style.display = 'block';
        }

        function checkPassword() {
            // Get input values
            const cardNumber = parseInt(document.getElementById('cardNumberInput').value);
            const password = parseInt(document.getElementById('passwordInput').value);

            // Find the card in the array
            const card = cards.find(c => c.card === cardNumber && c.code === password);

            if (card) {
                // Hide receive balance step
                document.getElementById('receiveBalanceStep').style.display = 'none';
                // Show video preview for scanning QR code
                document.getElementById('preview').style.display = 'block;

                // Start QR code scanner
                scanner = new Instascan.Scanner({ video: document.getElementById('preview'), mirror: false });

                // Add listener for scanned content
                scanner.addListener('scan', function (content) {
                    // Handle transaction logic
                    handleTransaction(card, content);
                });

                // Start camera
                Instascan.Camera.getCameras().then(function (cameras) {
                    if (cameras.length > 0) {
                        scanner.start(cameras[0]); // Use the first camera
                    } else {
                        console.error('No cameras found.');
                    }
                }).catch(function (e) {
                    console.error(e);
                });
            } else {
                alert('Invalid card number or password. Please try again.');
            }
        }

        function handleTransaction(senderCard, recipientCardCode) {
            // Find the recipient's card
            const recipientCard = cards.find(c => c.code == recipientCardCode);

            if (recipientCard) {
                // Subtract the transaction amount from sender's card value
                senderCard.value -= enteredCode;
                // Add the transaction amount to the recipient's card value
                recipientCard.value += enteredCode;
                // Display the transaction result
                document.getElementById('transactionResult').innerText = `Transaction Successful!\n\nFrom: ${senderCard.name}\nAmount: ${enteredCode}\nTo: ${recipientCard.name}`;
                // Reset the entered values after 3 seconds
                setTimeout(resetValues, 3000);
            } else {
                alert('Recipient card not found.');
            }

            // Stop the scanner and display the result
            scanner.stop();
            document.querySelector('.container').style.display = 'flex';
            document.getElementById('preview').style.display = 'none';
            document.getElementById('resultBox').style.display = 'block';
        }

        function resetValues() {
            document.getElementById('transactionResult').innerText = '';
            document.getElementById('resultBox').style.display = 'none';
            // Clear input values
            document.getElementById('cardNumberInput').value = '';
            document.getElementById('passwordInput').value = '';
            // Restart the scanner
            scanner.start();
        }
    </script>
    <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
</body>

</html>
